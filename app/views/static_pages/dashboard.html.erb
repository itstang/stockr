<% provide(:title, "Dashboard") %>
<h1>Dashboard</h1>

<p><b>Email:</b> <%= current_user.email %></p>
<p><b>Balance:</b> <%= current_user.balance %></p>


<table style="width:100%">
  <thead></thead>
  <tbody>
    <tr>

      <td>
        <!-- Line chart -->
        <div >
          <div>
            <canvas id="line-canvas" ></canvas>
          </div>
        </div>


        <script>
          var randomScalingFactor = function(){ return Math.round(Math.random()*100)};
          var lineChartData = {
            labels : ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            datasets : [
              {
                label: "My First dataset",
                fillColor : "rgba(220,220,220,0.2)",
                strokeColor : "rgba(220,220,220,1)",
                pointColor : "rgba(220,220,220,1)",
                pointStrokeColor : "#fff",
                pointHighlightFill : "#fff",
                pointHighlightStroke : "rgba(220,220,220,1)",
                data : [randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor(),randomScalingFactor()]
              }
            ]
          }
        
        </script>

      </td>

      <td>
        <!-- Watch list -->
        <h3>Watch list</h3>
        <%= form_tag(stocks_add_path, method: "get") do %>
          <%= label_tag(:symbol, "Stock Symbol:") %>
          <%= text_field_tag(:symbol) %>
          <%= submit_tag("Add to watch list") %>
        <% end %>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Symbol</th>
              <th>Company Name</th>
              <th>Asking Price</th>
              <th>Bidding Price</th>
              <th>Sentiment</th>
            </tr>
          </thead>
          <tbody>
            <% @user_owns.each_with_index do |stock, index| %>
              <tr>
                <td><%= stock.symbol %></td>
                <td><%= @data[index].name %></td>
                <td>$<%= @data[index].day_value_change %></td>
                <td>$<%= @data[index].bid %></td>
                <td><%= @data[index].sentiment %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </td>

    </tr>
    
    <tr>

      <td>
        <!-- Pie chart -->
        <div id="canvas-holder">
          <canvas id="pie-canvas" width="300" height="300"> </canvas>
        </div>


      </td>

      <td>
        <!-- Bar chart -->
        <div>
          <canvas id="bar-canvas"></canvas>
        </div>

        <%= javascript_tag do %>
          var randRGB = function () {
              return "rgba("+ Math.floor(Math.random()*256) + "," + Math.floor(Math.random()*256) + "," + Math.floor(Math.random()*256) + ",";
          };

          var prices = <%= raw @stock_prices.to_json %>
          var symbols = <%= raw @stock_symbols.to_json %>
          var shares = <%= raw @stock_shares.to_json %>


          var pieData = [];
          var i = 0;
          var base;
          for (i = 0; i < shares.length; i++) {
            base = randRGB();

            pieData.push({value: shares[i], color: "" + base + "0.5)", highlight: "" + base + "0.75)", label: symbols[i]})
          }


          var randomScalingFactor = function(){ return Math.round(Math.random()*100)};

          var barChartData = {
            labels : symbols,
            datasets : [
              {
                fillColor : "rgba(151,187,205,0.5)",
                strokeColor : "rgba(151,187,205,0.8)",
                highlightFill : "rgba(151,187,205,0.75)",
                highlightStroke : "rgba(151,187,205,1)",
                data : prices
              }
            ]
          }
          
        <% end %>
        
        <script>
        window.onload = function(){
          var ctx = document.getElementById("line-canvas").getContext("2d");
          window.myLine = new Chart(ctx).Line(lineChartData, {
            responsive: true
          });
          ctx = document.getElementById("pie-canvas").getContext("2d");
              window.myPie = new Chart(ctx).Pie(pieData);
          ctx = document.getElementById("bar-canvas").getContext("2d");
          window.myBar = new Chart(ctx).Bar(barChartData, {
            responsive : true
          });
        }
        </script>

      </td>

    </tr>

  </tbody>

</table>